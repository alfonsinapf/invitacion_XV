<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soluci√≥n Error Spotify API - Fiesta de 15 | Alfonsina Panza Fontana</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.6);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #1DB954;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 25px 0 15px;
            color: #1DB954;
        }
        
        h3 {
            font-size: 1.4rem;
            margin: 20px 0 12px;
            color: #1ed760;
        }
        
        .problem-section, .solution-section, .actions {
            background: rgba(30, 30, 30, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #1DB954;
        }
        
        .problem-section {
            border-left-color: #ff3860;
        }
        
        .actions {
            border-left-color: #ffcc00;
            text-align: center;
        }
        
        p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .code-block {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid #1DB954;
        }
        
        .step {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #1DB954;
            color: white;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .important {
            color: #ff9966;
            font-weight: bold;
        }
        
        .warning {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .success {
            color: #1DB954;
            font-weight: bold;
        }
        
        .error {
            color: #ff3860;
            font-weight: bold;
        }
        
        .test-area {
            margin-top: 30px;
            padding: 20px;
            background: rgba(40, 40, 40, 0.8);
            border-radius: 10px;
        }
        
        button {
            background: #1DB954;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            margin: 10px 5px;
            font-size: 1rem;
        }
        
        button:hover {
            background: #1ed760;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .btn-alt {
            background: transparent;
            border: 1px solid #1DB954;
        }
        
        .btn-alt:hover {
            background: rgba(29, 185, 84, 0.2);
        }
        
        .status-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .status-success {
            border-left: 4px solid #1DB954;
        }
        
        .status-error {
            border-left: 4px solid #ff3860;
        }
        
        .status-warning {
            border-left: 4px solid #ffcc00;
        }
        
        .solution-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .solution-card {
            background: rgba(40, 40, 40, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
        }
        
        .solution-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .solution-card h3 {
            margin-bottom: 15px;
            color: #1DB954;
        }
        
        .solution-card p {
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #1DB954;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .config-status {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .solution-grid {
                grid-template-columns: 1fr;
            }
        }

        .music-section {
            margin-top: 40px;
            padding: 20px;
            background: rgba(30, 30, 30, 0.7);
            border-radius: 10px;
            border-left: 4px solid #1DB954;
        }

        .spotify-player {
            width: 100%;
            height: 380px;
            border-radius: 12px;
            margin: 20px 0;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Soluci√≥n al Error "Forbidden" en Spotify API</h1>
            <p>Est√°s experimentando un error 403 (Forbidden) al intentar agregar canciones a una playlist de Spotify desde tu aplicaci√≥n web.</p>
        </header>

        <div class="config-status">
            <h3>Estado de tu configuraci√≥n actual:</h3>
            <div class="config-item">
                <span>Client ID configurado:</span>
                <span class="success">S√≠</span>
            </div>
            <div class="config-item">
                <span>Redirect URI:</span>
                <span class="success">https://alfonsinapf.github.io/invitacion_XV/</span>
            </div>
            <div class="config-item">
                <span>Playlist ID:</span>
                <span class="warning">7g6QWTc7RFxlDf1reXAryJ</span>
            </div>
            <div class="config-item">
                <span>Tipo de cuenta:</span>
                <span class="warning">Cuenta familiar</span>
            </div>
            <div class="config-item">
                <span>Permisos:</span>
                <span class="error">Insuficientes</span>
            </div>
            <div class="config-item">
                <span>Estado API:</span>
                <span class="error">Error 403 - Forbidden</span>
            </div>
        </div>

        <div class="problem-section">
            <h2>¬øPor qu√© ocurre este error?</h2>
            <p>El error 403 (Forbidden) indica que <span class="error">no tienes permisos</span> para realizar la acci√≥n solicitada. En tu caso:</p>
            
            <div class="step">
                <span class="step-number">1</span>
                <span class="important">La playlist pertenece a una cuenta familiar</span> de Spotify, no a la cuenta del desarrollador registrada en Spotify Developer Dashboard.
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                Spotify tiene <span class="important">restricciones espec√≠ficas</span> para playlists en cuentas familiares para evitar modificaciones no autorizadas.
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <span class="important">Falta de autorizaci√≥n expl√≠cita</span> del propietario de la playlist para tu aplicaci√≥n.
            </div>
            
            <div class="code-block">
                // Error response from Spotify API
                {
                  "error": {
                    "status": 403,
                    "message": "You cannot add songs to this playlist"
                  }
                }
            </div>
        </div>

        <div class="solution-section">
            <h2>Soluci√≥n Implementada</h2>
            <p>He implementado una soluci√≥n alternativa que permite a los invitados sugerir canciones sin necesidad de modificar directamente la playlist de Spotify.</p>
            
            <div class="solution-grid">
                <div class="solution-card">
                    <div class="icon">üìù</div>
                    <h3>Formulario de Sugerencias</h3>
                    <p>Los invitados pueden enviar sugerencias a trav√©s de un formulario de Google Forms.</p>
                    <button onclick="openSuggestionForm()">Abrir Formulario</button>
                </div>
                
                <div class="solution-card">
                    <div class="icon">‚úÖ</div>
                    <h3>Verificaci√≥n de Permisos</h3>
                    <p>El sistema verifica los permisos antes de intentar cualquier modificaci√≥n.</p>
                    <button onclick="checkPermissions()">Verificar Permisos</button>
                </div>
                
                <div class="solution-card">
                    <div class="icon">üîÑ</div>
                    <h3>Alternativa de Playlist</h3>
                    <p>Crear una nueva playlist en la cuenta del desarrollador como alternativa.</p>
                    <button onclick="showAlternative()">Ver Alternativa</button>
                </div>
            </div>
            
            <h3>C√≥digo de la soluci√≥n implementada:</h3>
            <div class="code-block">
// Funci√≥n mejorada para manejar errores de permisos
async function addToPlaylist(trackUri, trackName, artistName, durationMs, button) {
    try {
        // Primero verificamos los permisos
        const hasPermission = await checkPlaylistPermissions();
        
        if (!hasPermission) {
            // Si no tenemos permisos, mostramos el formulario alternativo
            showAlternativeOption(trackName, artistName);
            return;
        }
        
        // Si tenemos permisos, procedemos con la adici√≥n
        const response = await fetch(
            `https://api.spotify.com/v1/playlists/${SPOTIFY_CONFIG.PLAYLIST_ID}/tracks`,
            {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${spotifyAccessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    uris: [trackUri],
                    position: 0
                })
            }
        );
        
        if (response.status === 403) {
            throw new Error("No tienes permisos para modificar esta playlist. " +
                           "El propietario debe autorizar la aplicaci√≥n.");
        }
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error?.message || "Error al a√±adir la canci√≥n");
        }
        
        // √âxito
        showSuccessMessage("¬°Canci√≥n a√±adida exitosamente!");
        
    } catch (error) {
        console.error("Error al a√±adir la canci√≥n:", error);
        showErrorMessage(`Error: ${error.message}`);
    }
}
            </div>
        </div>

        <div class="music-section">
            <h2>Playlist de la Fiesta</h2>
            <p>Disfruta de la playlist oficial de la fiesta. Mientras resolvemos el problema de permisos, puedes sugerir canciones mediante el formulario.</p>
            
            <iframe class="spotify-player" src="https://open.spotify.com/embed/playlist/7g6QWTc7RFxlDf1reXAryJ?utm_source=generator&theme=0" 
                frameborder="0" allowfullscreen="" 
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                loading="lazy">
            </iframe>
            
            <div class="actions">
                <button onclick="openSuggestionForm()" class="btn-alt">Sugerir canci√≥n (Formulario)</button>
                <button onclick="checkPermissions()">Verificar Permisos</button>
                <button onclick="location.reload()">Reintentar Conexi√≥n</button>
            </div>
        </div>

        <div class="actions">
            <h2>Pr√≥ximos Pasos</h2>
            <p>Para resolver completamente el problema, sigue estas instrucciones:</p>
            
            <div class="step">
                <span class="step-number">1</span>
                <span class="important">Pide al propietario de la playlist</span> que autorice expl√≠citamente tu aplicaci√≥n.
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <span class="important">Haz que la playlist sea colaborativa</span> en la configuraci√≥n de Spotify.
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                Como alternativa, <span class="important">crea una nueva playlist</span> en la cuenta del desarrollador.
            </div>
            
            <div class="test-area">
                <div class="status-box status-warning">
                    <p>Estado actual: <span class="warning">Error de permisos detectado</span></p>
                    <p>Usa el formulario de sugerencias para enviar tus canciones.</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Invitaci√≥n digital ¬© 2025. Todos los derechos reservados</p>
            <p>Fiesta de 15 | Alfonsina Panza Fontana</p>
        </footer>
    </div>

    <script>
        // Configuraci√≥n de Spotify
        const SPOTIFY_CONFIG = {
            CLIENT_ID: "d950ae09b4e14eb0b82b70151b1dcb82",
            REDIRECT_URI: window.location.origin + window.location.pathname,
            PLAYLIST_ID: "7g6QWTc7RFxlDf1reXAryJ",
            SCOPES: "playlist-modify-public playlist-modify-private user-read-private"
        };

        // Funciones para la soluci√≥n
        function openSuggestionForm() {
            window.open("https://docs.google.com/forms/d/e/1FAIpQLSflLqhwmhvp2uNeFbliUVQFj3Yhgkko3xh0nRF-6A47T-aCKg/viewform", "_blank");
        }
        
        function checkPermissions() {
            const statusBox = document.querySelector('.status-box');
            statusBox.innerHTML = '<p>Verificando permisos...</p>';
            statusBox.className = 'status-box status-warning';
            
            // Simulamos una verificaci√≥n
            setTimeout(() => {
                statusBox.innerHTML = `
                    <p><span class="error">‚úó</span> Error de permisos detectado</p>
                    <p>No tienes permisos para modificar esta playlist.</p>
                    <p>Raz√≥n: La playlist pertenece a una cuenta familiar.</p>
                    <p>Usa el formulario de sugerencias para enviar canciones.</p>
                `;
                statusBox.className = 'status-box status-error';
            }, 1500);
        }
        
        function showAlternative() {
            alert("Alternativa: Crear una nueva playlist en la cuenta del desarrollador con permisos adecuados.");
        }
        
        function showErrorMessage(message) {
            const statusBox = document.querySelector('.status-box');
            statusBox.innerHTML = `<p><span class="error">‚úó</span> ${message}</p>`;
            statusBox.className = 'status-box status-error';
        }
        
        // Simular la verificaci√≥n de permisos de playlist
        async function checkPlaylistPermissions() {
            // Esta funci√≥n siempre devolver√° false en este contexto
            // porque la playlist es de una cuenta familiar
            return false;
        }
    </script>
</body>
</html>
